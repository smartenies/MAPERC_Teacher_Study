---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warnings = F)
options(qwraps2_markup = "markdown")

library(tidyverse)
library(readxl)
library(qwraps2)
```

## Relationships of social climate and indoor environmental quality and frequently reported health symptoms in a suburban school district

**Sheena E. Martenies**^1^, Jen Schill^2^, Matthew Klimm^2^, Jeni Cross^2^^,^^3^, Shannon Oliver^4^, Sheryl Magzamen^1^^,^^5^


^1^ Department of Environmental and Radiological Health Sciences, Colorado State University

^2^ Institute for the Built Environment, Colorado State University

^3^ Department of Sociology, Colorado State University

^4^ Manager, Energy and Sustainability, Partnering School District

^5^ Department of Epidemiology, Colorado School of Public Health

<br></br>
**Contact Us:**

Sheena.Martenies@colostate.edu

GitHub: [smartenies/MAPERC_Teacher_Study](https://github.com/smartenies/MAPERC_Teacher_Study)

### 1. Project overview

This document summarizes the analyses of school-level social climate score and individual-level self-reported health outcomes for teachers and staff in our participating school district. 

#### 1.1 Objectives

The primary objective of this study was to assess whether social climate scores at the school level were associated with self-reported number of frequent (i.e., experienced at least once per week) health symptoms among faculty and staff working in our partner school district. We also examined if indoor air quality scores were associated with health symptoms and whether social climate scores were a modifier of this effect.

### 2. Methods

#### 2.1 ELEVATE Survey
Staff at elementary, middle, and high schools in our participating district completed a social climate survey assessing their attitudes about their schools. Among other questions, these surveys assessed whether staff would recommend their schools to colleagues or friends looking for a job, how positive staff perceived the interactions between teachers and students to be, and whether staff were optimistic about their schools improving in the future. Data from these surveys was available at the school level. Our primary outcome from this survey was the overall social climate score, which accounts for responses to several of the survey's questions. We also used individual questions on the survey in secondary analyses. Higher climate scores correspond with more positive social climates as perceived by staff.

#### 2.2 Indoor Environment Survey
We also collected data on self-reported health symptoms at the individual level. These data came from an indoor environment survey that included questions on how indoor environmental variables such as lighting, noise, and air quality impacted the ability of staff to complete their jobs. This questionnaire asked teachers whether they experienced any of the following symptoms and, if yes, how frequently they experienced them:

- Headaches
- Wheezing (breathing with a whistling or rattling sound in your chest)
- Dry, itchy, or irritated eyes
- Sore or dry throat
- Stuffy or runny nose, or sinus congestion
- Sneezing
- Tired or strained eyes
- Tension, irritability, or nervousness
- Having a hard time paying attention
- Dizziness or lightheadedness
- Nausea or upset stomach
- Feeling depressed
- Feeling tired or lethargic

Our primary outcome of interest was the number of frequent heath symptoms reported by each individual. We considered a health outcome to be "frequent" if it occurred at least once a week. In secondary analyses, We also explored associations between social climate scores at the school level and frequent occurrence of each health outcome as a binary variable.

#### 2.3 Operational Report Card (ORC) Data

Operational report card (ORC) scores were used to characterize the quality of the built environment in each school. Overall ORC scores were based on the average score in five operations areas: energy efficiency, thermal comfort, acoustics, visual quality, and indoor air quality (IAQ). ORC scores were generated from a building survey completed by a graduate student completing walk-throughs of each participating school. Higher ORC scores were associated with higher quality indoor environments in the schools.  We were also interested in the IAQ component of the ORC score as a separate predictor in our model due to known associations between indoor contaminants and the health outcomes included in our survey. Both the mean overall ORC score and the IAQ score for each school were included in models as continuous variables.

#### 2.4 Statistical Analysis

Social climate survey data, ORC scores (overall and IAQ), and the number of frequent health outcomes were summarized as means and standard deviations (SD) or counts and frequencies as appropriate. We explore correlations between variables using Pearson's r statistic. 

Associations between social climate scores and the number of frequent health outcomes were assessed using generalized linear models with a Poisson log-link function with random effects for schools. To improve model convergence, the social climate scores and ORC scores were scaled prior to model fitting. We therefore report effect sizes for a standard deviation increase in social climate score or ORC score.

We also assessed relationships between social climate scores and individual health outcomes operationalized as binomial outcomes. We again used a generalized linear model with random effects for school and scaled exposure variables. 

For each of our models, we assessed interactions between social climate scores and job category (teacher vs. other)

All analyses were completed in `r R.Version()$version.string`.

### 3. Results

#### 3.1 Study Population
```{r, echo = F, include = F, warning=FALSE}
#' -----------------------------------------------------------------------------
#' Read in the clean indoor environment survey and social climate
#' Create a single dataset
#' Drop original survey variables
#' -----------------------------------------------------------------------------

q_data <- read_csv(here::here("Data", "Cleaned_Indoor_Env_Survey_Data.csv")) %>% 
  select(RecordedDate, ResponseId, school, 
         job_cat:loc_missing,
         light_dissatisfied, light_impact_work, 
         light_too_dark:light_issues_count,
         sound_dissatisfied, sound_impact_work, 
         sound_other_voices:sound_issues_count,
         temp_dissatisfied, temp_impact_work, 
         temp_heat_from_sun:light_issues_count,
         air_qual_dissatisfied, air_qual_stuffy, air_qual_musty,
         air_smell_dissatisfied,
         air_qual_trash:air_qual_issues_count,
         any_pets, pest_problem,
         any_headaches:freq_symptoms_count,
         leave_confident:leave_sad,
         environment_dissatisfied) 

q_schools <- unique(q_data$school)

e_data <- read_csv(here::here("Data", "Cleaned_ORC_Data.csv")) %>% 
  filter(school %in% q_schools)

s_data <- read_csv(here::here("Data", "Cleaned_Climate_Survey_Data.csv")) %>% 
  filter(school %in% q_schools)

l_data <- read_csv(here::here("Data", "Cleaned_School_SES_Data.csv")) %>% 
  filter(school %in% q_schools)

df <- left_join(q_data, l_data, by = "school") %>% 
  left_join(s_data, by = "school") %>% 
  left_join(e_data, by = "school")
  
glimpse(df)

# How many surveys did we have?
df2 <- filter(df, !is.na(school))
nrow(df2)

#' How many schools?
length(unique(df2$school))

#' How many responses at each school?
table(df2$school, useNA = 'ifany')
school_n <- df2 %>%
  select(school, ResponseId) %>% 
  group_by(school) %>% 
  tally()
  
#' Jobs represented?
length(unique(df2$job_cat))
job_n <- df2 %>%
  select(job_cat) %>% 
  group_by(job_cat) %>% 
  summarise(count = n() ) %>%
  mutate(pct = round((count / sum(count)) * 100, 1)) %>% 
  mutate(job_cat = str_replace(job_cat, "_", " ")) %>% 
  mutate(job_cat = str_replace(job_cat, "Other Not_Spec", "Other, Not Specified")) %>% 
  mutate(job_cat = str_replace(job_cat, "Admin", "Administrator")) %>% 
  mutate(job_cat = str_replace(job_cat, "Aide Monitor", "Aide or Monitor")) %>% 
  mutate(job_cat = str_replace(job_cat, "Media Tech", "Media Technician")) %>% 
  arrange(desc(count))

job_n[which(job_n$job_cat == "Teacher"), "pct"]

#' Primary work location
table(df2$primary_loc, useNA = 'ifany')
prop.table(table(df2$primary_loc, useNA = 'ifany'))

#' Distribution of free and reduced lunch
summary(df2$pct_free_reduced)
hist(df2$pct_free_reduced)
```

Overall, we collected data from `r nrow(df2)` participants representing `r length(unique(df2$school))` schools. The median (range) number of surveys collected from each school was `r median(school_n$n)` (`r min(school_n$n)` - `r max(school_n$n)`).

Our survey was available to teachers and other staff at the school. Overall, `r length(unique(df2$job_cat))` different job categories were represented (Table 1). Teachers made up the greatest percentage of participants (`r job_n[which(job_n$job_cat == "Teacher"), "pct"]`%)

```{r, include = T, echo = F, warning=FALSE}
knitr::kable(job_n,
             col.names = c("Job Category", "Count", "Percent"),
             caption = "Table 1. Summary of job categories represented",
             table.attr = "style='width:50%;'")
```

#### 3.2 Social Climate and Indoor Air Quality

```{r, echo = F, include = F, warning=FALSE}

#' -----------------------------------------------------------------------------
#' Summarize the ORC scores
#' Calculate an "average orc" for the 5 variables assessed
#'
#' The non-annotated scores are the average of the "site" and "occupant" scores
#' mean_orc is the average of the averaged scores for each component of the ORC
#' -----------------------------------------------------------------------------

#' Calulcate the mean score
df2 <- df2 %>%
  mutate(mean_orc = (energy_efficiency + thermal_comfort +
                           acoustics + visual_quality + iaq)/5)

#' Going to calculate scaled exposures and log-transformed exposures, too
df3 <- df2 %>%
  mutate(scale_energy_efficiency = scale(energy_efficiency),
         scale_thermal_comfort = scale(thermal_comfort),
         scale_acoustics = scale(acoustics),
         scale_visual_quality = scale(visual_quality),
         scale_iaq = scale(iaq),
         scale_mean_orc = scale(mean_orc))
 
orc_sum <- df3 %>% 
  select(mean_orc) %>% 
  summarize("Variable" = "Mean ORC score",
            "Mean (SD)" = paste0(round(mean(mean_orc, na.rm = T), 1),
                                 " (", round(sd(mean_orc, na.rm = T), 1), ")"),
            "Min" = round(min(mean_orc, na.rm = T), 1),
            "Median" = round(median(mean_orc, na.rm = T), 1),
            "Max" = round(max(mean_orc, na.rm = T), 1))

iaq_sum <- df3 %>% 
  select(iaq) %>% 
  summarize("Variable" = "Indoor air quality (IAQ) score",
            "Mean (SD)" = paste0(round(mean(iaq, na.rm = T), 1),
                                 " (", round(sd(iaq, na.rm = T), 1), ")"),
            "Min" = round(min(iaq, na.rm = T), 1),
            "Median" = round(median(iaq, na.rm = T), 1),
            "Max" = round(max(iaq, na.rm = T), 1))

#' -----------------------------------------------------------------------------
#' Summarize the climate survey data (school level)
#' -----------------------------------------------------------------------------

#' Calculate scaled exposures
df3$scale_overall_score_current <- scale(df3$overall_score_current)
df3$scale_recommend_strongly <- scale(df3$recommend_strongly)
df3$scale_work_env_positive <- scale(df3$work_env_positive)
df3$scale_students_enthusiatic <- scale(df3$students_enthusiatic)
df3$scale_optimistic_improvement <- scale(df3$optimistic_improvement)
df3$scale_students_supportive <- scale(df3$students_supportive)
df3$scale_colleagues_pos_attitude <- scale(df3$colleagues_pos_attitude)
df3$scale_teach_student_respectful <- scale(df3$teach_student_respectful)
df3$scale_students_helping <- scale(df3$students_helping)
df3$scale_colleagues_support_initiatives <- scale(df3$colleagues_support_initiatives)
df3$scale_teachers_trusted <- scale(df3$teachers_trusted)

clim_sum <- df3 %>% 
  select(overall_score_current) %>% 
  summarize("Variable" = "Social climate score",
            "Mean (SD)" = paste0(round(mean(overall_score_current, na.rm = T), 1),
                                 " (", round(sd(overall_score_current, na.rm = T), 1), ")"),
            "Min" = round(min(overall_score_current, na.rm = T), 1),
            "Median" = round(median(overall_score_current, na.rm = T), 1),
            "Max" = round(max(overall_score_current, na.rm = T), 1))

exp_sum <- bind_rows(clim_sum, orc_sum, iaq_sum)

```

There was substantial variability in the distribution of social climate scores across schools (Table 2). The scores ranged from `r round(min(df3$overall_score_current, na.rm = T), 1)` to `r round(max(df3$overall_score_current, na.rm = T), 1)`, with a median of `r round(median(df3$overall_score_current, na.rm = T), 1)`. 

Among the included schools, IAQ scores were higher on average compared to overall ORC scores (mean (SD) = `r round(mean(df3$mean_orc, na.rm = T), 1)` ( `r round(sd(df3$mean_orc, na.rm = T), 1)`) for mean ORC scores as compared to `r round(mean(df3$mean_orc, na.rm = T), 1)` ( `r round(sd(df3$mean_orc, na.rm = T), 1)`) for IAQ scores.

```{r, include = T, echo = F, warning=FALSE}
knitr::kable(exp_sum, caption = "Table 2. Summary of climate survey scores and operational report card (ORC) scores")
```

#### 3.3 Frequently Reported Health Symptoms
```{r, echo = F, include = F, warning=FALSE}

symptom_sum <-
  list("Number of frequent symptoms reported" =
       list("Min" = ~ min(.data$freq_symptoms_count, na_rm = T),
            "Max" = ~ max(.data$freq_symptoms_count, na_rm = T),
            "Mean (SD)" = ~ qwraps2::mean_sd(.data$freq_symptoms_count, na_rm = T)),
       "Headaches" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_headaches, na_rm = T)),
       "Wheeze" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_wheeze, na_rm = T)),
       "Eye irritation" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_eye_irritation, na_rm = T)),
       "Sore throat" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_sore_throat, na_rm = T)),
       "Sinus symptoms" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_sinus_symp, na_rm = T)),
       "Sneeze" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_sneeze, na_rm = T)),
       "Eye strain" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_eye_strain, na_rm = T)),
       "Tension, irritability, or nervousness " =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_tension, na_rm = T)),
       "Lack of attention" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_lack_atten, na_rm = T)),
       "Dizziness or lightheadedness" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_dizziness, na_rm = T)),
       "Nausea" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_nausea, na_rm = T)),
       "Feeling depressed" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_depression, na_rm = T)),
       "Lethargy or tiredness" =
       list("N (%)" = ~ qwraps2::n_perc0(.data$freq_lethargy, na_rm = T))
       )

all_symp <- summary_table(df2, symptom_sum)
teach_symp <- summary_table(dplyr::group_by(df2, job_teacher), symptom_sum)

#' Did teachers have more symptoms on average?
teach_t_test <- t.test(freq_symptoms_count ~ job_teacher, data = df2)

```

The number of frequent health outcomes reported ranged from `r min(df2$freq_symptoms_count, na.rm = T)` to `r max(df2$freq_symptoms_count, na.rm = T)` (Table 3). Teachers reported a slightly greater number of symptoms on average compared to other staff members (`r round(teach_t_test$estimate[2], 1)` vs. `r round(teach_t_test$estimate[1], 1)`, p = `r round(teach_t_test$p.value, 2)`). The most common frequent health symptoms among all staff were eye strain (44%) and lethargy or tiredness (37%).

```{r, echo = F, results = "asis"}
print(cbind(all_symp, teach_symp),
      cnames = c("All (N = 134)", "Not Teachers (N = 51)", "Teachers (N = 83)"),
      title = "Table 3. Summary of frequently reported health outcomes")
```

#### 3.4 Correlations between outcomes and exposures

``` {r, include = F, echo = F, warning=FALSE}
#' -----------------------------------------------------------------------------
#' Correlations between outcomes and exposures (ORC scores or social climate)
#' -----------------------------------------------------------------------------

library(ggcorrplot)
library(viridis)

df_corr <- df3 %>%
  select(iaq, mean_orc, overall_score_current, freq_symptoms_count,
         job_teacher, loc_classroom, pct_free_reduced) %>% 
  mutate(job_teacher = as.numeric(job_teacher),
         loc_classroom = as.numeric(loc_classroom))
cor(df_corr)

cor_plot <- ggcorrplot(round(cor(df_corr), 1), method = "circle", type = "upper",
           lab = F) +
  scale_x_discrete(labels = c("IAQ Score", "Mean ORC Score", "Social Climate Score",
                              "Frequent Symptom Count", "Teacher", "Classroom")) +
  scale_y_discrete(labels = c("Mean ORC Score", "Social Climate Score",
                              "Frequent Symptom Count", "Teacher", "Classroom",
                              "% Free and Reduced Lunch")) +
  scale_fill_viridis(name = "Correlation")

```

Overall social climate scores were negatively correlated with the number of frequent symptoms reported (r = `r round(cor(df3$overall_score_current, df3$freq_symptoms_count), 2)`) and the percentage of students at the school who qualified for free or reduced lunch (r = `r round(cor(df3$overall_score_current, df3$pct_free_reduced), 2)`) (Figure 1). The social climate score was also negatively correlated with the mean ORC score (r = `r round(cor(df3$overall_score_current, df3$mean_orc), 2)`) and the indoor air quality score (r = `r round(cor(df3$overall_score_current, df3$iaq), 2)`). 

```{r, echo = F, warnings = F, fig.cap = "Figure 1. Correlations between variables"}
suppressWarnings(print(cor_plot))
# jpeg(filename = here::here("Figs", "Variable_Corr_Plot.jpeg"),
#      width = 7, height = 5, units = "in", res = 500)
# suppressWarnings(print(cor_plot))
# dev.off()

```

#### 3.5 Associations between social climate scores and the number of frequent health outcomes reported

```{r, echo = F, include = F, warning=FALSE}

#' -----------------------------------------------------------------------------
#' Associations between social climate and number of health outcomes reported (count)
#' "Two pollutant" models with social climate and ORC scores
#'
#' The models include a random intercept for school
#' Using the scaled versions of the ORC scores for better model convergence
#' Covariates: job_teacher (binary), loc_classroom (binary), pct_free_reduced (continuous)
#'
#' Primary findings:
#'     - After controlling for being a teacher, working in a classroom, and
#'     school-level SES (% of students that qualify for free or reduced lunch),
#'     overall social climate score is associated with the number of types of
#'     frequent health outcomes reported
#' -----------------------------------------------------------------------------

library(lme4)
library(ggeffects)
library(sjPlot)

#' Make job_teacher and loc_classroom factors
df3 <- df3 %>%
  mutate(job_teacher = as.factor(job_teacher),
         loc_classroom = as.factor(loc_classroom))

#' Overall ORC + IAQ + SOC and the number of symptoms reported (frequent)
soc_orc_iaq_freq_ct <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                               scale_mean_orc + scale_iaq +
                               job_teacher + loc_classroom +
                               pct_free_reduced +
                               (1|school),
                             family = poisson, data = df3)
summary(soc_orc_iaq_freq_ct)

plot_model(soc_orc_iaq_freq_ct, type = "pred", terms = c("scale_overall_score_current"))

#' IAQ + SOC and the number of symptoms reported (frequent)
soc_iaq_freq_ct <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                            scale_iaq +
                            job_teacher + loc_classroom +
                            pct_free_reduced +
                            (1|school),
                         family = poisson, data = df3)
summary(soc_iaq_freq_ct)

plot_model(soc_iaq_freq_ct, type = "pred", terms = c("scale_overall_score_current"))

# jpeg(filename = here::here("Figs", "SOC_vs_Pred_Symp_Count.jpeg"),
#      width = 7, height = 5, units = "in", res = 500)
# plot_model(soc_iaq_freq_ct, type = "pred", terms = c("scale_overall_score_current"),
#            title = "",
# axis.title = c("Social climate score (scaled)", "Frequent health sypmtom count")) + 
#   theme_sjplot(base_size = 18) +
#   font_size(axis_title.x = 24, axis_title.y = 24, title = 24,
#             labels.x = 18, labels.y = 18) +
#   legend_style(inside = T, pos = "top_right")
# dev.off()
# 
# jpeg(filename = here::here("Figs", "IAQ_vs_Pred_Symp_Count.jpeg"),
#      width = 7, height = 5, units = "in", res = 500)
# plot_model(soc_iaq_freq_ct, type = "pred", terms = c("scale_iaq"),
#            title = "",
# axis.title = c("Indoor air quality score (scaled)", "Frequent health sypmtom Count")) + 
#   theme_sjplot(base_size = 18) +
#   font_size(axis_title.x = 24, axis_title.y = 24, title = 24,
#             labels.x = 18, labels.y = 18) +
#   legend_style(inside = T, pos = "top_right")
# dev.off()


#' IAQ and the number of symptoms reported (frequent)
iaq_freq_ct <- glmer(freq_symptoms_count ~ scale_iaq +
                       job_teacher + loc_classroom + 
                       pct_free_reduced +
                       (1|school), 
                     family = poisson, data = df3)
summary(iaq_freq_ct)
plot_model(iaq_freq_ct, type = "pred", terms = c("scale_iaq"))

#' Testing for an interaction between iaq + SOC
soc_iaq_freq_ct_int <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                               scale_iaq +
                               scale_overall_score_current*scale_iaq +
                               job_teacher + loc_classroom +
                               pct_free_reduced +
                           (1|school),
                         family = poisson, data = df3)

summary(soc_iaq_freq_ct_int)
plot_model(soc_iaq_freq_ct_int, type = "int", terms = c("scale_overall_score_current",
                                                        "scale_iaq"))

#' Are there differences for teachers and non-teachers?
soc_iaq_freq_ct_teach <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                                 scale_iaq + job_teacher + loc_classroom +
                                 pct_free_reduced +
                                 scale_overall_score_current * job_teacher +
                               (1|school),
                             family = poisson, data = df3)
summary(soc_iaq_freq_ct_teach)

tab_model(soc_iaq_freq_ct, soc_iaq_freq_ct_teach)
plot_model(soc_iaq_freq_ct_teach, type = "int", terms = c("scale_overall_score_current",
                                                           "job_teacher"))
#' Are there differences for classroom vs. non-classroom?
soc_iaq_freq_ct_class <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                                 scale_iaq + job_teacher + loc_classroom +
                                 pct_free_reduced +
                                 scale_overall_score_current * loc_classroom +
                                 (1|school),
                               family = poisson, data = df3)
summary(soc_iaq_freq_ct_class)

tab_model(soc_iaq_freq_ct, soc_iaq_freq_ct_class)
plot_model(soc_iaq_freq_ct_class, type = "int", terms = c("scale_overall_score_current",
                                                          "loc_classroom"))

#' Are there differences for high vs. low SES schools?
soc_iaq_freq_ct_ses <- glmer(freq_symptoms_count ~ scale_overall_score_current +
                                 scale_iaq + job_teacher + loc_classroom +
                                 pct_free_reduced +
                                 scale_overall_score_current * pct_free_reduced +
                                 (1|school),
                               family = poisson, data = df3)
summary(soc_iaq_freq_ct_ses)

tab_model(soc_iaq_freq_ct, soc_iaq_freq_ct_ses)
plot_model(soc_iaq_freq_ct_ses, type = "int", terms = c("scale_overall_score_current",
                                                        "pct_free_reduced"))

```

In models adjusted for being a teacher (binary), working in a classroom (binary), the percentage of students who qualify for free or reduced lunch (continuous), and the indoor air quality score (continuous), overall campus climate scores were negatively associated with the number of frequent health effects reported by staff at the schools (Table 4). A standard deviation increase in the campus social climate score was associated with 0.68-fold (95% confidence interval (CI): 0.48 - 0.95) change in the rate of frequent health outcomes reported by staff.

```{r, echo = F, warning=FALSE}
tab_model(soc_iaq_freq_ct, 
          show.p = F,
          pred.labels = c("Intercept", "Social Climate Score", "IAQ Score", "Teacher", "Classroom", "% Free and Reduced Lunch"),
          dv.labels = c("Frequent Health Outcomes"),
          title = "Table 4. Associations between IAQ and social climate scores and the number of frequent health effects reported")
```
<br/><br/>
We assessed whether social climate scores were an effect modifier on the relationship between indoor air quality scores and the number of frequent health outcomes reported. In a model without social climate scores, a 1 SD increase in IAQ scores was associated with an 1.08-fold change (95% CI: 0.88 - 1.34) the rate of frequent health outcomes reported (Table 5). After stratifying on social climate scores (above vs. below the mean), the relationship between IAQ and the number of frequent health outcomes varied. For participants at low social climate score schools, a 1 SD increase in IAQ scores was associated with a 0.96-fold change (95%CI: 0.72 - 1.28) in the rate of self-reported frequent health outcomes; for participants at high social climate schools, a 1-sd increase in IAQ scores was associated with a 0.49-fold change (95%CI: 0.35 - 0.70) in the rate of frequent health symptoms. Our stratified analysis suggested that social climate may modify the effect of IAQ on the rate of frequent health outcomes reported by staff at the schools.

```{r, echo = F, include = F}
#' Split into high and low social climate
df3_low <- filter(df3, scale_overall_score_current <= 0)
df3_high <- filter(df3, scale_overall_score_current > 0)

iaq_freq_ct_high_soc <- glmer(freq_symptoms_count ~ scale_iaq +
                       job_teacher + loc_classroom + 
                       pct_free_reduced +
                       (1|school), 
                     family = poisson, data = df3_high)
summary(iaq_freq_ct_high_soc)

iaq_freq_ct_low_soc <- glmer(freq_symptoms_count ~ scale_iaq +
                                job_teacher + loc_classroom + 
                                pct_free_reduced +
                                (1|school), 
                              family = poisson, data = df3_low)
summary(iaq_freq_ct_low_soc)
```

```{r, echo = F, warning=FALSE}
tab_model(iaq_freq_ct, iaq_freq_ct_high_soc, iaq_freq_ct_low_soc,
          show.p = F,
          pred.labels = c("Intercept", "IAQ Score", "Teacher", "Classroom", "% Free and Reduced Lunch"),
          dv.labels = c("All Staff", "Staff at High Social Climate Schools", "Staff at Low Social Climate Schools"),
          title = "Table 5. Assessing effect modification of social climate scores on associations between IAQ and the number of frequent health outcomes reported")
```
<br/><br/>
We also observed differences in how social environment scores were associated with the number of frequent health effects reported by job status. For teachers, the association between social climate scores and frequent health effects was attenuated compared to other staff members (Figure 2).

```{r, echo = F, warning=FALSE}
plot_model(soc_iaq_freq_ct_teach, type = "int", terms = c("scale_overall_score_current",
                                                           "job_teacher"),
           title = "Figure 2. Interaction between social climate score and job category\nand the number of frequent health outcomes reported",
           axis.title = c("Social climate score (scaled)", "Frequent Health Outcome Count"),
           legend.title = "Teacher")

# jpeg(filename = here::here("Figs", "SOC_Teacher_Interaction.jpeg"),
#      height = 5, width = 7.5, units = "in", res = 600)
# plot_model(soc_iaq_freq_ct_teach, type = "int", terms = c("scale_overall_score_current",
#                                                            "job_teacher"),
#            title = "",
#            axis.title = c("Social climate score (scaled)", "Frequent Health Outcome Count"),
#            legend.title = "Teacher") +
#   theme_sjplot(base_size = 60) +
#   font_size(axis_title.x = 60, axis_title.y = 60, title = 60,
#             labels.x = 36, labels.y = 36) +
#   legend_style(inside = T, pos = "top_right")
# dev.off()


```

#### 3.6 Associations between social climate scores and specific frequent health outcomes

```{r, echo = F, include = F, warnings = F}
#' -----------------------------------------------------------------------------
#' Associations between overall social environment scores and specific health
#' symptoms
#'
#' Outcomes: headaches, eye_irritation, sore_throat, sinus_symp, sneeze,
#' eye_strain, tension, lack_atten, dizziness, nausea, depression, lethargy
#'
#' The models include a random intercept for school
#'
#' Using the scaled versions of the social environment survey score for better
#' model convergence
#'
#' Covariates: scale_iaq (continuous), job_teacher (binary), loc_classroom
#' (binary), pct_free_reduced (continuous)
#'
#' Main findings:
#'     - Overall social climate score was negatively associated with lethargy
#'     - Being a teacher was associated with feelings of depression or sadness
#'     - The effect of overall campus climate on feelings of depression was
#'     stronger for non-teachers compared to teachers
#' -----------------------------------------------------------------------------

#' SOC and self-reported frequent headaches
soc_freq_headache <- glmer(freq_headaches ~
                             scale_overall_score_current + scale_iaq +
                             job_teacher + loc_classroom + pct_free_reduced +
                             (1|school),
                           family = binomial, data = df3)
summary(soc_freq_headache)
plot_model(soc_freq_headache, type = "pred", terms = c("scale_overall_score_current"))
plot_model(soc_freq_headache, type = "pred", terms = c("scale_iaq"))

#' SOC and self-reported frequent eye_irritations
soc_freq_eye_irritation <- glmer(freq_eye_irritation ~
                                   scale_overall_score_current + scale_iaq +
                                   job_teacher + loc_classroom + pct_free_reduced +
                                   (1|school),
                                 family = binomial, data = df3)
summary(soc_freq_eye_irritation)

#' SOC and self-reported frequent sore_throat
soc_freq_sore_throat <- glmer(freq_sore_throat ~
                                scale_overall_score_current + scale_iaq +
                                job_teacher + loc_classroom + pct_free_reduced +
                                (1|school),
                              family = binomial, data = df3)
summary(soc_freq_sore_throat)

#' SOC and self-reported frequent sinus_symp
soc_freq_sinus_symp <- glmer(freq_sinus_symp ~
                               scale_overall_score_current + scale_iaq +
                               job_teacher + loc_classroom + pct_free_reduced +
                               (1|school),
                             family = binomial, data = df3)
summary(soc_freq_sinus_symp)

#' SOC and self-reported frequent sneeze
soc_freq_sneeze <- glmer(freq_sneeze ~
                           scale_overall_score_current + scale_iaq +
                           job_teacher + loc_classroom + pct_free_reduced +
                           (1|school),
                         family = binomial, data = df3)
summary(soc_freq_sneeze)

#' SOC and self-reported frequent eye_strain
soc_freq_eye_strain <- glmer(freq_eye_strain ~
                               scale_overall_score_current + scale_iaq +
                               job_teacher + loc_classroom + pct_free_reduced +
                               (1|school),
                             family = binomial, data = df3)
summary(soc_freq_eye_strain)

#' SOC and self-reported frequent tension
soc_freq_tension <- glmer(freq_tension ~
                            scale_overall_score_current + scale_iaq +
                            job_teacher + loc_classroom + pct_free_reduced +
                            (1|school),
                          family = binomial, data = df3)
summary(soc_freq_tension)

#' SOC and self-reported frequent lack_atten
soc_freq_lack_atten <- glmer(freq_lack_atten ~
                               scale_overall_score_current + scale_iaq +
                               job_teacher + loc_classroom + pct_free_reduced +
                               (1|school),
                             family = binomial, data = df3)
summary(soc_freq_lack_atten)

#' SOC and self-reported frequent dizziness
soc_freq_dizziness <- glmer(freq_dizziness ~
                              scale_overall_score_current + scale_iaq +
                              job_teacher + loc_classroom + pct_free_reduced +
                              (1|school),
                            family = binomial, data = df3)
summary(soc_freq_dizziness)

plot_model(soc_freq_dizziness, type = "pred", terms = c("scale_overall_score_current"))
plot_model(soc_freq_dizziness, type = "eff", terms = c("job_teacher"))

#' SOC and self-reported frequent nausea
soc_freq_nausea <- glmer(freq_nausea ~
                           scale_overall_score_current + scale_iaq +
                           job_teacher + loc_classroom + pct_free_reduced +
                           (1|school),
                         family = binomial, data = df3)
summary(soc_freq_nausea)

#' SOC and self-reported frequent depression
soc_freq_depression <- glmer(freq_depression ~
                               scale_overall_score_current + scale_iaq +
                               job_teacher + loc_classroom + pct_free_reduced +
                               (1|school),
                             family = binomial, data = df3)
summary(soc_freq_depression)

plot_model(soc_freq_depression, type = "pred", terms = c("scale_overall_score_current"))
plot_model(soc_freq_depression, type = "eff", terms = c("job_teacher"))
plot_model(soc_freq_depression, type = "eff", terms = c("loc_classroom"))

#' Is there an interaction between being a teacher and social climate score?
soc_freq_depression_teach <- glmer(freq_depression ~
                                     scale_overall_score_current + scale_iaq +
                                     job_teacher + loc_classroom + pct_free_reduced +
                                     scale_overall_score_current * job_teacher +
                                     (1|school),
                                   family = binomial, data = df3)
summary(soc_freq_depression_teach)

tab_model(soc_freq_depression, soc_freq_depression_teach)
plot_model(soc_freq_depression_teach, type = "int",
           terms = c("scale_overall_score_current",
                     "job_teacher"))

#' SOC and self-reported frequent lethargy
soc_freq_lethargy <- glmer(freq_lethargy ~
                             scale_overall_score_current + scale_iaq +
                             job_teacher + loc_classroom +
                             pct_free_reduced +
                             (1|school),
                           family = binomial, data = df3)
summary(soc_freq_lethargy)

plot_model(soc_freq_lethargy, type = "pred", terms = c("scale_overall_score_current"))

#' Is there an interaction between being a teacher and social climate score?
soc_freq_lethargy_teach <- glmer(freq_lethargy ~
                                   scale_overall_score_current + scale_iaq +
                                   job_teacher + loc_classroom + pct_free_reduced +
                                   scale_overall_score_current * job_teacher +
                                   (1|school),
                                 family = binomial, data = df3)
summary(soc_freq_lethargy_teach)

tab_model(soc_freq_lethargy, soc_freq_lethargy_teach)
plot_model(soc_freq_lethargy_teach, type = "int",
           terms = c("scale_overall_score_current",
                     "job_teacher"))

#' Is there an interaction between school SES and social climate score?
soc_freq_lethargy_ses <- glmer(freq_lethargy ~
                                 scale_overall_score_current + scale_iaq +
                                 job_teacher + loc_classroom + pct_free_reduced +
                                 scale_overall_score_current * pct_free_reduced +
                                 (1|school),
                               family = binomial, data = df3)
summary(soc_freq_lethargy_ses)

tab_model(soc_freq_lethargy, soc_freq_lethargy_ses)
plot_model(soc_freq_lethargy_ses, type = "int",
           terms = c("scale_overall_score_current",
                     "pct_free_reduced"))
```
<br/><br/>
We assessed relationships between social climate score and specific frequently occurring health outcomes in mixed-effects logistic regression models. In models adjusted for being a teacher (binary), working in a classroom (binary), the percentage of students who qualify for free or reduced lunch (continuous), and the indoor air quality score (continuous), overall campus climate scores were negatively associated with the odds of frequent headache, dizziness, and lethargy (Table 5). In particulate, a 1 SD increase in social climate scores was associated with an odds ratio for frequent lethargy of 0.35 (95% CI: 0.17 - 0.72). We also found that being a teacher was associated with higher odds of frequent depression symptoms (OR = 9.94 (95%CI: 1.41- 70.37)), though the confidence interval for this association was wide (Table 6).

```{r, echo = F, warning=FALSE}
tab_model(soc_freq_headache, soc_freq_dizziness, soc_freq_lethargy, soc_freq_depression,
          show.p = F,
          pred.labels = c("Intercept", "Social Climate Score", "IAQ Score", "Teacher", "Classroom", "% Free and Reduced Lunch"),
          dv.labels = c("Frequent Headaches", "Frequent Dizziness", "Frequent Lethargy", "Frequent Depression"),
          title = "Table 6. Associations between social climate score and frequent health outcomes")
```
<br/><br/>
We observed an interaction between being a teacher and overall social climate scores on the odds of frequent depression symptoms (Figure 3). For teachers, the effect of social climate on the odds of frequent depression was attenuated relative to those not working as teachers.

```{r, echo = F, warning=FALSE}
plot_model(soc_freq_depression_teach, type = "int",
           terms = c("scale_overall_score_current", "job_teacher"),
           title = "Figure 3. Interaction between social climate score and job category\non odds of experiencing frequent depression",
           axis.title = c("Social climate score (scaled)", "Frequency of Reported Depression Symptoms"),
           legend.title = "Teacher")
```

### 4. Summary of main findings

Overall, we found that higher social climate scores were associated with lower rates of frequently reported health symptoms among survey participants in our school. Social climate scores were inversely associated with the odds of experiencing frequent headaches, dizziness, and lethargy. Being a teacher was associated with increased odds of experiencing frequent depression. 

Social climate scores may modify the effect of indoor air quality on the rate of frequently reported health symptoms. Staff in schools with higher social climate scores had lower rates of frequent health outcomes compared to staff from low social climate schools.

We also found that that the relationship between higher social climate scores and lower rates of frequent health symptoms was attenuated for participants who were teachers compared to other job categories. As social climate scores were only available at the school level, we were not able to assess whether there were differences in how teachers assess their schools' social climates relative to other staff working in the school.

